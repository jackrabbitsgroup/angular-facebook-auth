"use strict";angular.module("jackrabbitsgroup.angular-facebook-auth",[]).factory("jrgFacebookAuth",["$rootScope",function($rootScope){function init(){inited=!0}function setFBOpts(fbId,params){fbAppId=fbId,params.fbPerms&&(fbPerms=params.fbPerms)}function setFBLoginVars(params){fbConnectTrig=!0;var map1={userID:"uid",accessToken:"access_token",expiresIn:"expires"};for(var xx in params.fbSessInfo)fbCookie[xx]=params.fbSessInfo[xx],map1[xx]&&(fbCookie[map1[xx]]=params.fbSessInfo[xx])}function loginFB(params){var xx,fbLoginVarsParams={},sessInfo={},dataString="fbLogin=1";if(params.response&&params.response.session||void 0!==FB.getAuthResponse&&FB.getAuthResponse()){if(params.response&&params.response.session){var sessInfoOld=params.response.session;sessInfo={};var map1={uid:"userID",access_token:"accessToken",expires:"expiresIn"};for(xx in sessInfoOld)map1[xx]?sessInfo[map1[xx]]=sessInfoOld[xx]:sessInfo[xx]=sessInfoOld[xx]}else sessInfo=FB.getAuthResponse();dataString+="&fbUserId="+sessInfo.userID;for(xx in sessInfo)dataString+="&fbCookie["+xx+"]="+sessInfo[xx],fbLoginVarsParams[xx]=sessInfo[xx]}setFBLoginVars({fbSessInfo:fbLoginVarsParams}),params.callback.args&&void 0!==params.callback.args?void 0===params.callback.args.length&&(params.callback.args=[params.callback.args]):params.callback.args=[];var args=params.callback.args.concat([fbCookie]);1==args.length&&(args=args[0]),$rootScope.$broadcast(params.callback.evtName,args),$rootScope.$$phase||$rootScope.$apply()}var self={destroy:function(){fbConnectTrig=!1,alreadyFBInited=!1,fbCookie={},inited=!1},init:function(params){if(inited||init({}),params.fbAppId||params.fbPerms){fbAppId=!1;var ppSend={};params.fbAppId&&(fbAppId=params.fbAppId),params.fbPerms&&(ppSend.fbPerms=params.fbPerms),setFBOpts(fbAppId,ppSend)}void 0===window.FB||alreadyFBInited||(alreadyFBInited=!0,window.globalPhoneGap&&globalPhoneGap?("undefined"==typeof PhoneGap&&"undefined"==typeof cordova&&"undefined"==typeof Cordova&&alert("PhoneGap/Cordova variable does not exist. Check that you have included phonegap.js (or cordova.js) correctly"),"undefined"==typeof PG&&"undefined"==typeof CDV&&alert("PG/CDV variable does not exist. Check that you have included pg-plugin-fb-connect.js (or cdv-plugin-fb-connect.js) correctly"),"undefined"==typeof FB&&alert("FB variable does not exist. Check that you have included the Facebook JS SDK file."),"undefined"==typeof CDV?FB.init({appId:fbAppId,frictionlessRequests:!0,nativeInterface:PG.FB}):FB.init({appId:fbAppId,frictionlessRequests:!0,nativeInterface:CDV.FB})):FB.init({appId:fbAppId,frictionlessRequests:!0,status:!0,cookie:!0,xfbml:!0}))},login:function(params){var needToLogIn=!0;params.alreadyLoggedIn?needToLogIn=!1:(window.FB&&void 0===params.FBLoggedOut||!params.FBLoggedOut)&&FB.getLoginStatus(function(response){(response.authResponse||response.session)&&(params.response=response,needToLogIn=!1,loginFB(params))}),needToLogIn===!1?loginFB(params):FB.login(function(response){(response.authResponse||response.session)&&(params.response=response,loginFB(params))},{scope:fbPerms})}},inited=!1,fbCookie={},alreadyFBInited=!1,fbAppId=!1,fbPerms="email,user_birthday",fbConnectTrig=!1;return self}]);